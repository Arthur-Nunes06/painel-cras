<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro - Usuários e Profissionais</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
      background: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 0 8px #ccc;
    }
    h2 {
      margin-top: 1.5em;
    }
    label {
      display: block;
      margin-top: 1em;
      font-weight: bold;
    }
    input, select, button {
      font-size: 1rem;
      padding: 0.5em;
      margin-top: 0.3em;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
      background: #0a3d62;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 1em;
    }
    button:hover {
      background: #054a91;
    }
    ul {
      margin-top: 0.5em;
      padding-left: 1.2em;
    }
    ul li {
      margin-bottom: 0.4em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #e0e0e0;
      border-radius: 4px;
      padding: 0.3em 0.5em;
    }
    ul li button {
      background: #d9534f;
      padding: 0.2em 0.5em;
      font-size: 0.9rem;
      border-radius: 4px;
      border: none;
      color: white;
      cursor: pointer;
    }
    ul li button:hover {
      background: #c9302c;
    }
    .msg {
      margin-top: 0.8em;
      color: green;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>

  <h1>Cadastro de Usuários e Profissionais</h1>

  <section id="profissionais-section">
    <h2>Profissionais</h2>
    <label for="novoProfissional">Nome do profissional:</label>
    <input type="text" id="novoProfissional" placeholder="Ex: Psicólogo Otiniel" />
    <button id="btnAddProf">Adicionar Profissional</button>
    
    <ul id="listaProfissionais"></ul>
  </section>

  <hr />

  <section id="usuarios-section">
    <h2>Cadastrar Usuário na Fila</h2>
    <label for="nomeUsuario">Nome do usuário:</label>
    <input type="text" id="nomeUsuario" placeholder="Nome do usuário" />
    
    <label for="selectProfissional">Selecionar profissional:</label>
    <select id="selectProfissional">
      <option value="" disabled selected>-- Selecione --</option>
    </select>

    <button id="btnCadastrarUsuario">Cadastrar na fila</button>
    <div id="msgUsuario" class="msg"></div>
  </section>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>

  <script>
    // Config Firebase (troque pelas suas configs)
    const firebaseConfig = {
      apiKey: "AIzaSyChT_LbedW9M1lsyK26HUCCDCcJc4hoQf4",
      authDomain: "painelcras-4890c.firebaseapp.com",
      databaseURL: "https://painelcras-4890c-default-rtdb.firebaseio.com",
      projectId: "painelcras-4890c",
      storageBucket: "painelcras-4890c.appspot.com",
      messagingSenderId: "279841059682",
      appId: "1:279841059682:web:be689ab69135f04cb4323b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Autenticação anônima
    firebase.auth().signInAnonymously().catch(console.error);

    // Elementos
    const inputNovoProf = document.getElementById('novoProfissional');
    const btnAddProf = document.getElementById('btnAddProf');
    const listaProfissionais = document.getElementById('listaProfissionais');
    const selectProfissional = document.getElementById('selectProfissional');

    const inputNomeUsuario = document.getElementById('nomeUsuario');
    const btnCadastrarUsuario = document.getElementById('btnCadastrarUsuario');
    const msgUsuario = document.getElementById('msgUsuario');

    // Atualiza a lista e select de profissionais do Firebase
    function atualizarListaProfissionais(profs) {
      // Limpa lista
      listaProfissionais.innerHTML = '';
      selectProfissional.innerHTML = '<option value="" disabled selected>-- Selecione --</option>';

      for (const key in profs) {
        if (Object.hasOwnProperty.call(profs, key)) {
          const nomeProf = profs[key];

          // Lista
          const li = document.createElement('li');
          li.textContent = nomeProf;

          // Botão remover
          const btnRemover = document.createElement('button');
          btnRemover.textContent = 'Excluir';
          btnRemover.onclick = () => {
            if (confirm(`Deseja realmente excluir o profissional "${nomeProf}"?`)) {
              db.ref('profissionais/' + key).remove();
            }
          };

          li.appendChild(btnRemover);
          listaProfissionais.appendChild(li);

          // Select
          const option = document.createElement('option');
          option.value = nomeProf;
          option.textContent = nomeProf;
          selectProfissional.appendChild(option);
        }
      }
    }

    // Escuta mudanças dos profissionais no Firebase
    db.ref('profissionais').on('value', snapshot => {
      const profs = snapshot.val() || {};
      atualizarListaProfissionais(profs);
    });

    // Adicionar profissional
    btnAddProf.onclick = () => {
      const nome = inputNovoProf.value.trim();
      if (!nome) {
        alert('Digite o nome do profissional.');
        return;
      }
      // Gera um id automático (timestamp)
      const novoId = Date.now().toString();
      db.ref('profissionais/' + novoId).set(nome)
        .then(() => {
          inputNovoProf.value = '';
        })
        .catch(e => alert('Erro ao adicionar profissional: ' + e.message));
    };

    // Cadastrar usuário na fila
    btnCadastrarUsuario.onclick = () => {
      const nomeUsuario = inputNomeUsuario.value.trim();
      const profissional = selectProfissional.value;

      if (!nomeUsuario) {
        msgUsuario.textContent = "Digite o nome do usuário.";
        msgUsuario.className = 'error';
        return;
      }
      if (!profissional) {
        msgUsuario.textContent = "Selecione um profissional.";
        msgUsuario.className = 'error';
        return;
      }

      const filaRef = db.ref('fila/' + profissional);
      const id = Date.now().toString();

      filaRef.child(id).set({ nome: nomeUsuario, profissional })
        .then(() => {
          msgUsuario.textContent = `Usuário "${nomeUsuario}" cadastrado na fila do ${profissional}.`;
          msgUsuario.className = 'msg';
          inputNomeUsuario.value = '';
          selectProfissional.value = '';
        })
        .catch(e => {
          msgUsuario.textContent = 'Erro ao cadastrar: ' + e.message;
          msgUsuario.className = 'error';
        });
    };
  </script>
</body>
</html>
