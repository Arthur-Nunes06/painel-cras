<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Usuário e Profissionais</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2em auto; }
    label, select, input, button { font-size: 1rem; margin: 0.5em 0; display: block; width: 100%; }
    button { padding: 0.5em; }
    .profissional-item { display: flex; justify-content: space-between; margin-bottom: 0.3em; }
    .profissional-item button { width: auto; padding: 0 0.5em; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
</head>
<body>

  <h1>Gerenciar Profissionais</h1>
  <input type="text" id="novoProfissional" placeholder="Nome do profissional" />
  <button onclick="adicionarProfissional()">Adicionar Profissional</button>

  <div id="listaProfissionais"></div>

  <hr/>

  <h1>Cadastrar Usuário na Fila</h1>
  <input type="text" id="nomeUsuario" placeholder="Nome do usuário" />
  <label for="selectProfissional">Selecione o profissional:</label>
  <select id="selectProfissional"></select>
  <button onclick="cadastrarUsuario()">Cadastrar Usuário</button>

  <script>
    let db;

    window.onload = function() {
      // Config Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyChT_LbedW9M1lsyK26HUCCDCcJc4hoQf4",
        authDomain: "painelcras-4890c.firebaseapp.com",
        databaseURL: "https://painelcras-4890c-default-rtdb.firebaseio.com",
        projectId: "painelcras-4890c",
        storageBucket: "painelcras-4890c.appspot.com",
        messagingSenderId: "279841059682",
        appId: "1:279841059682:web:be689ab69135f04cb4323b"
      };

      firebase.initializeApp(firebaseConfig);
      db = firebase.database();

      firebase.auth().signInAnonymously()
        .catch(e => alert('Erro de autenticação: ' + e.message));

      carregarProfissionais();
    };

    function carregarProfissionais() {
      db.ref('profissionais').on('value', snapshot => {
        const listaDiv = document.getElementById('listaProfissionais');
        const selectProf = document.getElementById('selectProfissional');
        const profs = snapshot.val() || {};

        // Limpa lista e select
        listaDiv.innerHTML = '';
        selectProf.innerHTML = '';

        for (const key in profs) {
          // Lista para remover
          const div = document.createElement('div');
          div.className = 'profissional-item';
          div.textContent = profs[key];
          const btn = document.createElement('button');
          btn.textContent = 'Excluir';
          btn.onclick = () => excluirProfissional(key);
          div.appendChild(btn);
          listaDiv.appendChild(div);

          // Opção para select
          const option = document.createElement('option');
          option.value = profs[key];
          option.textContent = profs[key];
          selectProf.appendChild(option);
        }
      });
    }

    function adicionarProfissional() {
      const nome = document.getElementById('novoProfissional').value.trim();
      if (!nome) {
        alert('Digite o nome do profissional');
        return;
      }

      // Cria uma chave única para o profissional
      const novoRef = db.ref('profissionais').push();
      novoRef.set(nome)
        .then(() => {
          document.getElementById('novoProfissional').value = '';
        })
        .catch(e => alert('Erro ao salvar: ' + e.message));
    }

    function excluirProfissional(key) {
      if (!confirm('Confirma exclusão do profissional?')) return;
      db.ref('profissionais/' + key).remove();
    }

    function cadastrarUsuario() {
      const nomeUsuario = document.getElementById('nomeUsuario').value.trim();
      const profissional = document.getElementById('selectProfissional').value;

      if (!nomeUsuario) {
        alert('Digite o nome do usuário');
        return;
      }
      if (!profissional) {
        alert('Selecione um profissional');
        return;
      }

      const timestamp = Date.now();
      db.ref(`fila/${profissional}/${timestamp}`).set({ nome: nomeUsuario })
        .then(() => {
          alert(`Usuário ${nomeUsuario} cadastrado para ${profissional}`);
          document.getElementById('nomeUsuario').value = '';
        })
        .catch(e => alert('Erro ao cadastrar usuário: ' + e.message));
    }
  </script>
</body>
</html>
