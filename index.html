<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Atendimento</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
    }
    input, select, button {
      font-size: 1.2rem;
      padding: 0.5em;
      margin: 0.5em;
      width: 250px;
    }
  </style>
</head>
<body>
  <h1>Cadastro de Atendimento</h1>

  <input type="text" id="nome" placeholder="Nome da pessoa" />
  <br />
  <select id="profissional"></select>
  <br />
  <button onclick="cadastrar()">Cadastrar na Fila</button>

  <p id="msg"></p>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>

  <script>
    // Config Firebase (confira se está igual ao seu)
    const firebaseConfig = {
      apiKey: "AIzaSyChT_LbedW9M1lsyK26HUCCDCcJc4hoQf4",
      authDomain: "painelcras-4890c.firebaseapp.com",
      databaseURL: "https://painelcras-4890c-default-rtdb.firebaseio.com",
      projectId: "painelcras-4890c",
      storageBucket: "painelcras-4890c.appspot.com",
      messagingSenderId: "279841059682",
      appId: "1:279841059682:web:be689ab69135f04cb4323b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Login anônimo
    firebase.auth().signInAnonymously().catch(e => {
      document.getElementById('msg').textContent = "Erro de autenticação: " + e.message;
    });

    const profissionalSelect = document.getElementById('profissional');
    const msg = document.getElementById('msg');

    // Carregar profissionais do banco e popular select
    function carregarProfissionais() {
      db.ref('profissionais').once('value')
        .then(snapshot => {
          const profs = snapshot.val();
          profissionalSelect.innerHTML = '';
          if (!profs) {
            profissionalSelect.innerHTML = '<option disabled>Sem profissionais cadastrados</option>';
            return;
          }
          Object.entries(profs).forEach(([key, nome]) => {
            const opt = document.createElement('option');
            opt.value = nome;
            opt.textContent = nome;
            profissionalSelect.appendChild(opt);
          });
        })
        .catch(err => {
          msg.textContent = "Erro ao carregar profissionais: " + err.message;
        });
    }

    carregarProfissionais();

    function cadastrar() {
      const nome = document.getElementById('nome').value.trim();
      const profissional = profissionalSelect.value;

      if (!nome) {
        alert("Digite o nome da pessoa.");
        return;
      }
      if (!profissional) {
        alert("Selecione um profissional.");
        return;
      }

      // Referência da fila do profissional
      const filaRef = db.ref('fila/' + profissional);

      // Gerar ID único com timestamp
      const id = Date.now().toString();

      // Gravar na fila
      filaRef.child(id).set({ nome })
        .then(() => {
          msg.textContent = `Cadastro realizado: ${nome} para ${profissional}`;
          document.getElementById('nome').value = '';
        })
        .catch(e => {
          msg.textContent = "Erro ao cadastrar: " + e.message;
        });
    }
  </script>
</body>
</html>
