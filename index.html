<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro e Profissionais</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: auto; padding: 2em; }
    input, select, button { font-size: 1rem; margin: 0.5em 0; padding: 0.5em; width: 100%; }
    button { cursor: pointer; }
    ul { list-style: none; padding: 0; }
    li { margin: 0.3em 0; background: #eee; padding: 0.3em 0.5em; display: flex; justify-content: space-between; align-items: center; }
    li button { background: crimson; border: none; color: white; cursor: pointer; padding: 0 0.5em; border-radius: 3px; }
    .msg { margin: 1em 0; color: green; }
  </style>
</head>
<body>
  <h1>Cadastro de Usuário na Fila</h1>

  <input type="text" id="nomeUsuario" placeholder="Nome do usuário" />
  <select id="selectProfissional"></select>
  <button onclick="cadastrarUsuario()">Cadastrar na Fila</button>

  <div class="msg" id="msgUsuario"></div>

  <hr />

  <h2>Gerenciar Profissionais</h2>
  <input type="text" id="novoProfissional" placeholder="Nome do profissional" />
  <button onclick="adicionarProfissional()">Adicionar Profissional</button>

  <ul id="listaProfissionais"></ul>
  <div class="msg" id="msgProfissional"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyChT_LbedW9M1lsyK26HUCCDCcJc4hoQf4",
      authDomain: "painelcras-4890c.firebaseapp.com",
      databaseURL: "https://painelcras-4890c-default-rtdb.firebaseio.com",
      projectId: "painelcras-4890c",
      storageBucket: "painelcras-4890c.appspot.com",
      messagingSenderId: "279841059682",
      appId: "1:279841059682:web:be689ab69135f04cb4323b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    firebase.auth().signInAnonymously().catch(e => alert("Erro auth: " + e.message));

    const selectProfissional = document.getElementById('selectProfissional');
    const listaProfissionais = document.getElementById('listaProfissionais');
    const msgUsuario = document.getElementById('msgUsuario');
    const msgProfissional = document.getElementById('msgProfissional');

    // Carregar profissionais
    function carregarProfissionais() {
      db.ref('profissionais').once('value').then(snapshot => {
        const profs = snapshot.val() || {};
        selectProfissional.innerHTML = '';
        listaProfissionais.innerHTML = '';

        Object.entries(profs).forEach(([id, nome]) => {
          // option no select
          const opt = document.createElement('option');
          opt.value = nome;
          opt.textContent = nome;
          selectProfissional.appendChild(opt);

          // item na lista com botão remover
          const li = document.createElement('li');
          li.textContent = nome;
          const btnRemover = document.createElement('button');
          btnRemover.textContent = "X";
          btnRemover.onclick = () => removerProfissional(id);
          li.appendChild(btnRemover);
          listaProfissionais.appendChild(li);
        });

        if (selectProfissional.options.length === 0) {
          selectProfissional.innerHTML = '<option disabled>Sem profissionais cadastrados</option>';
        }
      }).catch(e => {
        msgProfissional.textContent = 'Erro ao carregar profissionais: ' + e.message;
      });
    }

    carregarProfissionais();

    // Adicionar profissional
    function adicionarProfissional() {
      const nome = document.getElementById('novoProfissional').value.trim();
      if (!nome) {
        alert("Digite o nome do profissional");
        return;
      }
      const novoRef = db.ref('profissionais').push();
      novoRef.set(nome)
        .then(() => {
          msgProfissional.textContent = `Profissional "${nome}" adicionado!`;
          document.getElementById('novoProfissional').value = '';
          carregarProfissionais();
        })
        .catch(e => {
          msgProfissional.textContent = 'Erro ao adicionar profissional: ' + e.message;
        });
    }

    // Remover profissional
    function removerProfissional(id) {
      if (!confirm("Remover profissional?")) return;
      db.ref('profissionais/' + id).remove()
        .then(() => {
          msgProfissional.textContent = 'Profissional removido.';
          carregarProfissionais();
        })
        .catch(e => {
          msgProfissional.textContent = 'Erro ao remover: ' + e.message;
        });
    }

    // Cadastrar usuário na fila
    function cadastrarUsuario() {
      const nome = document.getElementById('nomeUsuario').value.trim();
      const profissional = selectProfissional.value;

      if (!nome) {
        alert("Digite o nome do usuário");
        return;
      }
      if (!profissional) {
        alert("Selecione um profissional");
        return;
      }

      const filaRef = db.ref('fila/' + profissional);
      const id = Date.now().toString();

      filaRef.child(id).set({ nome })
        .then(() => {
          msgUsuario.textContent = `Usuário "${nome}" cadastrado na fila de ${profissional}`;
          document.getElementById('nomeUsuario').value = '';
        })
        .catch(e => {
          msgUsuario.textContent = 'Erro ao cadastrar: ' + e.message;
        });
    }
  </script>
</body>
</html>
