<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro de Usuário e Profissionais</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 500px; margin: auto; }
    input, select, button { font-size: 1rem; padding: 0.5em; margin: 0.5em 0; width: 100%; }
    ul { padding-left: 1.2em; }
  </style>

  <!-- Firebase SDK: carregue antes do script abaixo -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
</head>
<body>
  <h1>Cadastro de Profissionais e Usuários na Fila</h1>

  <section>
    <h2>Gerenciar Profissionais</h2>
    <input type="text" id="inputProfissional" placeholder="Nome do profissional" />
    <button id="btnAddProf">Adicionar Profissional</button>
    <ul id="listaProfissionais"></ul>
  </section>

  <section>
    <h2>Cadastro de Usuário na Fila</h2>
    <input type="text" id="inputNomeUsuario" placeholder="Nome do usuário" />
    <select id="selectProfissional"></select>
    <button id="btnAddUsuario">Cadastrar Usuário na Fila</button>
  </section>

  <script>
    window.onload = function() {
      // Config Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyChT_LbedW9M1lsyK26HUCCDCcJc4hoQf4",
        authDomain: "painelcras-4890c.firebaseapp.com",
        databaseURL: "https://painelcras-4890c-default-rtdb.firebaseio.com",
        projectId: "painelcras-4890c",
        storageBucket: "painelcras-4890c.appspot.com",
        messagingSenderId: "279841059682",
        appId: "1:279841059682:web:be689ab69135f04cb4323b"
      };

      firebase.initializeApp(firebaseConfig);
      firebase.auth().signInAnonymously().catch(console.error);
      const db = firebase.database();

      // Referências
      const profListEl = document.getElementById('listaProfissionais');
      const selectProfEl = document.getElementById('selectProfissional');
      const inputProfEl = document.getElementById('inputProfissional');
      const inputNomeUsuarioEl = document.getElementById('inputNomeUsuario');
      const btnAddProf = document.getElementById('btnAddProf');
      const btnAddUsuario = document.getElementById('btnAddUsuario');

      // Função para atualizar a lista e o select dos profissionais
      function atualizarProfissionais() {
        db.ref('profissionais').once('value').then(snapshot => {
          const profs = snapshot.val() || {};
          // Atualiza lista na tela
          profListEl.innerHTML = '';
          selectProfEl.innerHTML = '';

          Object.entries(profs).forEach(([key, nome]) => {
            // Lista para remoção
            const li = document.createElement('li');
            li.textContent = nome + ' ';
            const btnRemover = document.createElement('button');
            btnRemover.textContent = 'Remover';
            btnRemover.onclick = () => {
              if(confirm(`Remover profissional ${nome}?`)) {
                db.ref('profissionais/' + key).remove()
                  .then(() => {
                    alert('Profissional removido!');
                    atualizarProfissionais();
                  })
                  .catch(err => alert('Erro ao remover: ' + err.message));
              }
            };
            li.appendChild(btnRemover);
            profListEl.appendChild(li);

            // Opção select
            const option = document.createElement('option');
            option.value = nome;
            option.textContent = nome;
            selectProfEl.appendChild(option);
          });

          if (Object.keys(profs).length === 0) {
            profListEl.innerHTML = '<li>Nenhum profissional cadastrado.</li>';
            selectProfEl.innerHTML = '<option disabled>Cadastre um profissional primeiro</option>';
          }
        });
      }

      // Adicionar profissional
      btnAddProf.onclick = () => {
        const nome = inputProfEl.value.trim();
        if (!nome) {
          alert('Digite o nome do profissional');
          return;
        }
        // Gerar id simples baseado em timestamp
        const id = 'prof_' + Date.now();
        db.ref('profissionais/' + id).set(nome)
          .then(() => {
            alert('Profissional cadastrado!');
            inputProfEl.value = '';
            atualizarProfissionais();
          })
          .catch(err => alert('Erro ao cadastrar: ' + err.message));
      };

      // Adicionar usuário na fila
      btnAddUsuario.onclick = () => {
        const nomeUsuario = inputNomeUsuarioEl.value.trim();
        const profissional = selectProfEl.value;
        if (!nomeUsuario) {
          alert('Digite o nome do usuário');
          return;
        }
        if (!profissional) {
          alert('Selecione um profissional');
          return;
        }
        const idFila = Date.now().toString();
        db.ref(`fila/${profissional}/${idFila}`).set({ nome: nomeUsuario })
          .then(() => {
            alert(`Usuário ${nomeUsuario} cadastrado na fila do ${profissional}`);
            inputNomeUsuarioEl.value = '';
          })
          .catch(err => alert('Erro ao cadastrar na fila: ' + err.message));
      };

      // Inicializa lista de profissionais na tela e select
      atualizarProfissionais();
    }
  </script>
</body>
</html>
