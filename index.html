<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro - CRAS</title>
</head>
<body style="font-family:sans-serif; text-align:center; padding:2em;">
  <h1>Cadastro de Atendimento</h1>

  <h2>Cadastrar Usuário na Fila</h2>
  <input type="text" id="nomeUsuario" placeholder="Nome do usuário" />
  <select id="listaProfissionais"></select>
  <button onclick="cadastrarUsuario()">Cadastrar</button>

  <h2>Gerenciar Profissionais</h2>
  <input type="text" id="nomeProfissional" placeholder="Nome do profissional" />
  <button onclick="adicionarProfissional()">Adicionar Profissional</button>
  <ul id="profissionaisList"></ul>

  <script type="module">
    import { db } from './firebase-config.js';
    import {
      ref, push, set, onValue, remove
    } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-database.js";

    const listaProfissionais = document.getElementById('listaProfissionais');
    const profissionaisList = document.getElementById('profissionaisList');

    function atualizarListaProfissionais() {
      const profRef = ref(db, 'profissionais');
      onValue(profRef, (snapshot) => {
        listaProfissionais.innerHTML = '';
        profissionaisList.innerHTML = '';
        snapshot.forEach(child => {
          const key = child.key;
          const nome = child.val();
          const option = document.createElement('option');
          option.value = nome;
          option.textContent = nome;
          listaProfissionais.appendChild(option);

          const li = document.createElement('li');
          li.textContent = nome;
          const btn = document.createElement('button');
          btn.textContent = 'Remover';
          btn.onclick = () => remove(ref(db, 'profissionais/' + key));
          li.appendChild(btn);
          profissionaisList.appendChild(li);
        });
      });
    }

    function adicionarProfissional() {
      const nome = document.getElementById('nomeProfissional').value.trim();
      if (!nome) return alert('Digite o nome do profissional');
      const profRef = ref(db, 'profissionais');
      const novo = push(profRef);
      set(novo, nome);
      document.getElementById('nomeProfissional').value = '';
    }

    function cadastrarUsuario() {
      const nome = document.getElementById('nomeUsuario').value.trim();
      const profissional = listaProfissionais.value;
      if (!nome || !profissional) return alert('Preencha todos os campos');
      const filaRef = ref(db, `fila/${profissional}/${Date.now()}`);
      set(filaRef, { nome });
      document.getElementById('nomeUsuario').value = '';
      alert('Usuário cadastrado na fila!');
    }

    atualizarListaProfissionais();
  </script>
</body>
</html>
