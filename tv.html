<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel TV</title>
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      background: black;
      color: white;
      font-family: sans-serif;
    }
    .video {
      flex: 1;
    }
    .info {
      flex: 1;
      padding: 2em;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .info h1, .info ul {
      margin-bottom: 2em;
    }
  </style>
</head>
<body>
  <div class="video">
    <iframe width="100%" height="100%" src="https://www.youtube.com/embed/OPtRHSv2huE?autoplay=1&mute=1&controls=0&loop=1&playlist=OPtRHSv2huE" frameborder="0" allowfullscreen></iframe>
  </div>
  <div class="info">
    <h1 id="chamadaAtual">Aguardando chamada...</h1>
    <h2>Ãšltimas 5 chamadas:</h2>
    <ul id="ultimosChamados"></ul>
    <audio id="som" src="assets/beep.mp3" preload="auto"></audio>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    firebase.auth().signInAnonymously();
    const chamadaEl = document.getElementById('chamadaAtual');
    const listaEl = document.getElementById('ultimosChamados');
    const som = document.getElementById('som');
    let ultimoNome = '';

    db.ref('chamadoAtual').on('value', snap => {
      const dados = snap.val();
      if (dados && dados.nome !== ultimoNome) {
        chamadaEl.innerText = `${dados.nome} - ${dados.profissional}`;
        som.play();
        ultimoNome = dados.nome;
      } else if (!dados) {
        chamadaEl.innerText = 'Aguardando chamada...';
        ultimoNome = '';
      }
    });

    db.ref('historicoChamadas').limitToLast(5).on('value', snap => {
      const list = snap.val();
      listaEl.innerHTML = '';
      if (list) {
        const arr = Object.values(list).reverse();
        arr.forEach(d => {
          const li = document.createElement('li');
          li.textContent = `${d.nome} (${d.profissional}) - ${d.hora}`;
          listaEl.appendChild(li);
        });
      }
    });
  </script>
</body>
</html>
